---
title: "RoadAccidentSeverity"
author: "Alexandre Robin"
date: "`r Sys.Date()`"
output: rmdformats::material
---

```{r setup, echo=False, include=FALSE}

require(dplyr, install.packages('dplyr'))
require(knitr, install.packages('knitr'))
require(ggplot2, install.packages('ggplot'))
require(naniar, install.packages('naniar'))
require(rmdformats, install.packages('rmdformats'))
require(tidyr, install.packages('tidyr'))
require(visdat, install.packages('visdat'))

knitr::opts_chunk$set(echo = TRUE)
```

```{r}
boxplot <- function(data, target, var){
  ggplot(data, aes(y=data[,target], x=data[,var],colour=data[,var],fill=data[,var]))+
  geom_boxplot(alpha=0.5, outlier.alpha=0)+geom_jitter(width=0.25)+
  stat_summary(fun=mean, colour="black", geom="point",shape=18, size=2)+
  scale_color_discrete(name=var) + scale_fill_discrete(name=var)+
  labs(x=var, y=target, title = paste(target, "vs", var))
}

plot_multi_var <- function(train, target, var_quant, var_qual){
  ggplot(train, aes_string(x = var_quant, y =target, color=var_qual)) +
  geom_point()+geom_smooth(method = "lm")
}
```


# Exploratory Data Analysis

```{r cars}
original_caract <- read.csv2(
  'preprocessed_caract.csv', 
  header=TRUE,
  sep=';'
)
original_lieux <- read.csv2(
  'preprocessed_lieux.csv', 
  header=TRUE,
  sep=';'
)
original_veh <- read_csv2(
  'preprocessed_veh.csv', 
  header=TRUE,
  sep=';'
)

caract <- original_caract
lieux <- original_lieux
veh <- original_lieux
```

## Target

```{r}
target_name <- 'grav' 
target <- usagers[,target_name]

data <- usagers
var <- target_name

g <- ggplot(data, aes(data[,var], colour=data[,var], fill=data[,var])) +
    geom_bar() +
    scale_color_discrete(name=var) + scale_fill_discrete(name=var)+
    labs(x=var)
print(g)

# g <- ggplot(data, aes(y=data[,target], x=data[,var], colour=data[,var], fill=data[,var])) +
#   geom_boxplot(alpha=0.5, outlier.alpha=0)+geom_jitter(width=0.25)+
#   stat_summary(fun=mean, colour="black", geom="point",shape=18, size=3)+
#   scale_color_discrete(name=var) + scale_fill_discrete(name=var)+
#   labs(x=var, y=target, title = paste(target, "vs", var))
# print(g)

# boxplot <- function(data, target, var)
```

## Data merger

```{r}
library(dplyr)
data <- caract %>% merge(vehicules, by='Num_Acc') %>% merge(usagers, by='Num_Acc') %>% merge(lieux, by='Num_Acc')
data %>% head

# data <- dplyr::reduce(list(caract, vehicules, usagers, lieux), full_join, by='Num_Acc')
# doesn't work
```

